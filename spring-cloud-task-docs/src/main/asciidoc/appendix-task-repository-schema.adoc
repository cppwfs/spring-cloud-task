[[appendix-task-repository-schema]]
== Task Repository Schema

[[partintro]]
--
This appendix provides an ERD for the database schema used in the task repository.
--

image::task_schema.png[]

=== Table Information
--

.TASK_EXECUTION
Stores the task execution information.
[width="80%", cols="1,1,1,1,1,10", options="header"]
|=========================================================
|Column Name |Required |Type |Field Length | Default Values |Notes

|TASK_EXECUTION_ID |TRUE |BIGINT | X | X |
Spring Cloud Task Framework at app startup establishes the next available id as obtained from the `TASK_SEQ`. Or if the record is created outside of task then the value must be populated at record creation time.

|START_TIME |FALSE | DATETIME | X | NULL | Spring Cloud Task Framework at app startup establishes the value.

|END_TIME |FALSE | DATETIME | X | NULL | Spring Cloud Task Framework at app exit establishes the value.

|TASK_NAME |FALSE | VARCHAR | 100 | "" | Spring Cloud Task Framework at app startup will set this to "Application" unless user establish the name using the spring.cloud.task. name as discussed <<features-task-name,here>>

|EXIT_CODE |FALSE | INTEGER | X | 0 | Spring Cloud Task Framework at app exit establishes the value.

|EXIT_MESSAGE |FALSE | VARCHAR | 2500 | "" | Spring Cloud Task Framework at app exit establishes the value.

|ERROR_MESSAGE |FALSE | VARCHAR | 2500 | "" | Spring Cloud Task Framework at app exit establishes the value.

|LAST_UPDATED |TRUE | DATETIME | X | X | Spring Cloud Task Framework at app startup establishes the value. Or if the record is created outside of task then the value must be populated at record creation time.

|EXTERNAL_EXECUTION_ID |FALSE | VARCHAR | 250 | "" | If the `spring.cloud.task.external-execution-id` property is set then Spring Cloud Task Framework at app startup will set this to the value specified.   More information can be found <<features-external_task_id,here>>

|PARENT_TASK_EXECUTION_ID |FALSE |BIGINT | X | X | If the `spring.cloud.task.parent-execution-id` property is set then Spring Cloud Task Framework at app startup will set this to the value specified.   More information can be found <<features-parent_task_id,here>>

|=========================================================

.TASK_EXECUTION_PARAMS
Stores the parameters used for a task execution
[width="80%", cols="1,1,1,1,1", options="header"]
|=========================================================
|Column Name |Required |Type |Field Length | Default Values
|TASK_EXECUTION_ID |TRUE |BIGINT | X | X |

|TASK_PARAM |FALSE | VARCHAR | 2500 | "" |

|=========================================================

.TASK_TASK_BATCH
Used to link the task execution to the batch execution.
[width="80%", cols="1,1,1,1,1", options="header"]
|=========================================================
|Column Name |Required |Type |Field Length | Default Values

|TASK_EXECUTION_ID |TRUE |BIGINT | X | X |

|JOB_EXECUTION_ID |TRUE | BIGINT | X | X |

|=========================================================


.TASK_LOCK
Used for the `single-instance-enabled` feature discussed <<features-single-instance-enabled,here>>.
[width="80%", cols="1,1,1,1,1,10", options="header"]
|=========================================================
|Column Name |Required |Type |Field Length | Default Values |Notes

|LOCK_KEY |TRUE |CHAR | 36 | X | UUID for the this lock

|REGION |TRUE | VARCHAR  | 100 | DEFAULT | User can establish a group of locks using this field.

|CLIENT_ID |TRUE | CHAR  | 36 | X | The task execution id that contains the name of the app to lock.

|CREATED_DATE |TRUE | DATETIME  | X | X | The date that the entry was created

|=========================================================


NOTE: The DDL for setting up tables for each database type can be found https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-core/src/main/java/org/springframework/cloud/task/repository/database/support[here].
--
